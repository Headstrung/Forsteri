import csv
import subprocess
import webbrowser
import wx
import wx.html
import wx.adv

class OpenFrame(wx.Frame):
    def __init__(self, *args, **kwargs):
        super(OpenFrame, self).__init__(*args, **kwargs)
        self.initUI()

    def initUI(self):
        # Create the master panel.
        self.masterPanel = wx.Panel(self)

        # Create the master sizer.
        self.masterSizer = wx.GridBagSizer(5, 5)

        # Set the initial select status.
        self.currentSelect = "Account"

        ### Initialize the radio buttons.
        buttonLabels = ["Account", "Class", "Component", "Chemical"]
        labelLen = len(buttonLabels)

        radioButtons = [wx.RadioButton(self.masterPanel, label=buttonLabels[0],
            style=wx.RB_GROUP)]
        for i in range(1, labelLen):
            radioButtons.append(wx.RadioButton(self.masterPanel,
                label=buttonLabels[i]))

        staticBox = wx.StaticBox(self.masterPanel, label="Search by")
        rbSizer = wx.StaticBoxSizer(staticBox, wx.HORIZONTAL)

        rbFlag = wx.ALL | wx.EXPAND | wx.ALIGN_CENTER

        for j in range(0, labelLen):
            if self.currentSelect is buttonLabels[j]:
                radioButtons[j].SetValue(True)
            else:
                radioButtons[j].SetValue(False)
            rbSizer.Add(radioButtons[j], flag=rbFlag, border=10)
            self.Bind(wx.EVT_RADIOBUTTON, lambda event, select=buttonLabels[j]:
                self.setSearch(event, select), radioButtons[j])

        self.masterSizer.Add(rbSizer, pos=(0, 0), span=(1, 5), flag=rbFlag,
            border=10)

        ### Initialize the combo boxes.
        accounts = self.getComboList(self.currentSelect.lower())
        cbFlag = wx.ALL | wx.EXPAND
        self.topText = wx.StaticText(self.masterPanel,
            label=self.currentSelect)
        self.topBox = wx.ComboBox(self.masterPanel, choices=accounts,
            style=wx.CB_READONLY)
        self.Bind(wx.EVT_COMBOBOX, self.drawNextComboBox, self.topBox)
        self.masterSizer.Add(self.topText, pos=(1, 0), flag=cbFlag, border=10)
        self.masterSizer.Add(self.topBox, pos=(1, 1), span=(1, 4), flag=cbFlag,
            border=5)

        ### Initialize the buttons.
        # Create the open and cancel buttons.
        openButton = wx.Button(self.masterPanel, id=wx.ID_OPEN, label="&Open")
        cancelButton = wx.Button(self.masterPanel, id=wx.ID_CANCEL,
            label="&Cancel")
        openButton.SetFocus()

        # Add the buttons to the master sizer.
        bFlag = wx.ALL | wx.EXPAND | wx.ALIGN_BOTTOM
        self.masterSizer.Add(openButton, pos=(5, 0), flag=bFlag, border=10)
        self.masterSizer.Add(cancelButton, pos=(5, 4), flag=bFlag, border=10)

        # Set the bindings for actions when a button is clicked.
        self.Bind(wx.EVT_BUTTON, self.onOpen, openButton)
        self.Bind(wx.EVT_BUTTON, self.onCancel, cancelButton)

        # Make the sizer dynamic.
        self.masterSizer.AddGrowableCol(2)
        self.masterSizer.AddGrowableRow(0)

        # Set the sizer for the main panel.
        self.masterPanel.SetSizer(self.masterSizer)

        # Set window properties.
        self.SetSize((500, 325))
        self.SetTitle("Open Forecast")
        self.Centre()
        self.Show(True)

    def drawNextComboBox(self, event):
        pass

    def setSearch(self, event, select):
        self.currentSelect = select
        self.topText.SetLabel(select)
        self.topBox.SetSelection(0)

    def onOpen(self, event):
        print("Opening")

    def onCancel(self, event):
        self.Close()

    def getComboList(self, source):
        # Initialize list.
        lst = []

        # Pull accounts from data
        with open("../../data/" + source + ".csv", newline='') as csvFile:
            fileReader = csv.reader(csvFile, delimiter=',', quotechar='|')
            for row in fileReader:
                lst.append(row)

        # Return just the first row.
        lst = lst[0]
        lst.insert(0, "")
        return lst

def main():
    app = wx.App()
    OpenFrame(None)
    app.MainLoop()

if __name__ == '__main__':
    main()
